/**
author: jiansuna
date: 2016-07-05
description: 各个模块的方法
*/
define(["public/util.js"], function(u) {

    window.u = u;

    function about() {

    }

    function industry() {

    }

    function role() {

    }
    //签到页面
    function check() {
        XuntongJSBridge.call('getLocation', {}, function(result) {
            $('#detailAds').text(result.data.addressdetail);
        });
    }

    function featurelist() {

    }
    //附近终端
    function terminal() {
        // 百度地图API功能
        /*var map = new BMap.Map("allmap");
var point = new BMap.Point(116.331398, 39.897445);
map.centerAndZoom(point, 16);
var mk = new BMap.Marker(point);
map.addOverlay(mk);
map.panTo(point);
//增加附近终端
function addLayer(text, x, y) {
    var opts = {
        position: point, // 指定文本标注所在的地理位置
        offset: new BMap.Size(x, y) //设置文本偏移量
    }
    var label = new BMap.Label(text, opts); // 创建文本标注对象
    map.addOverlay(label);
}
addLayer("w导入终端100", 30, -10);
addLayer("w导入终端86", 10, -50);
//点击事件
map.addEventListener("click", function(e) {
    if (e.overlay) {
        $('#terminalDetail').find('h5').text(e.overlay.content);
        //$('#terminalDetail').find('h5').next().text(result.data.addressdetail);

        $('#terminalDetail').show();
    }
});
*/


        XuntongJSBridge.call('getLocation', {}, function(result) {
            $('#detailAds').text(result.data.addressdetail);
            var map = new BMap.Map("allmap");
            var point = new BMap.Point(result.data.longitude, result.data.latitude);
            map.centerAndZoom(point, 17);
            var mk = new BMap.Marker(point);
            map.addOverlay(mk);
            map.panTo(point);
            //增加附近终端
            function addLayer(text, x, y) {
                var opts = {
                    position: point, // 指定文本标注所在的地理位置
                    offset: new BMap.Size(x, y) //设置文本偏移量
                }
                var label = new BMap.Label(text, opts); // 创建文本标注对象
                map.addOverlay(label);
            }
            addLayer("壹加壹便利店", 50, -10);
            addLayer("佳福商场", 10, -100);
            //点击事件
            function mapevent() {
                map.addEventListener("click", function(e) {
                    if (e.overlay) {
                        $('#terminalDetail').find('h5').text(e.overlay.content);
                        $('#terminalDetail').find('h5').next().text(result.data.addressdetail);

                        $('#terminalDetail').show();
                    };
                });
            }
            setTimeout(mapevent, 500);
        });



    }

    function addterminal() {
        XuntongJSBridge && XuntongJSBridge.call('createPop', {
                "popTitle": "提交"
            },
            function(result) {
                u.showSubmitSuc();
            })
        XuntongJSBridge.call('getLocation', {}, function(result) {
            $('#detailAds').text(result.data.addressdetail);
        });
    }

    function myterminal() {
        XuntongJSBridge.call('getLocation', {}, function(result) {
            $('.terminal-list .cur-location').text(result.data.addressdetail);
        });
        var curDate = new Date().getFullYear() + '-' + (new Date().getMonth() + 1) + '-' + new Date().getDate();
        $('.terminal-list .cur-time').text(curDate);
    }

    function activedetail() {
        XuntongJSBridge.call('getLocation', {}, function(result) {
            $('.active-detail .cur-location').text(result.data.addressdetail);
        });
    }

    function editterminal() {

    }

    //拜访八步骤
    function visitstep() {
        //点击右上角的提交按钮
        XuntongJSBridge && XuntongJSBridge.call('createPop', {
                    "popTitle": "提交"
                },
                function(result) {
                    var curStep = $('#visitstepNav').find('li.cur').index();
                    if (curStep < 7) {
                        $('#visitstepNav').find('li').eq(curStep + 1).click();
                    } else {
                        u.showSubmitSuc();
                    }
                })
            //拜访一进来指定选中的tab
        var curStep = u.getUrlParams('step');
        if (curStep) {
            $('#visitstepNav').find('li').eq(curStep - 1).click();
        }
        //拜访的位置
        XuntongJSBridge.call('getLocation', {}, function(result) {
            $('#visitLocation').text(result.data.addressdetail);
        });


        //产品铺货的list
        $.qryData('distribute', distributeCb);
        //竞品的list
        $.qryData('opponent', opponentCb);

        //拜访八步骤tab的滑动效果
        $('#visitstepNav').on('touchstart', touch);
        $('#visitstepNav').on('touchmove', touch);
        $('#visitstepNav').on('touchend', touch);
        var beforeClient = null;

        function distributeCb(data) {
            var distribute_str = "",
                ordermanage_str = "";
            for (var i = 0, len = data.length; i < len; i++) {
                distribute_str += '<li><span class="triangle-right distribute-fold"><img src="assets/css/image/triangle-right.png" /></span><span>' + data[i] + '</span></li>';
                ordermanage_str += '<li><span class="triangle-right ordermanage-fold"><img src="assets/css/image/triangle-right.png" /></span><span>' + data[i] + '</span></li>';
            }
            $('#distributeContent').html(distribute_str);
            $('#orderManageContent').html(ordermanage_str);
        }

        function opponentCb(data) {
            var opponent_str = "";
            for (var i = 0, len = data.length; i < len; i++) {
                opponent_str += '<li><span class="triangle-right opponent-fold"><img src="assets/css/image/triangle-right.png" /></span><span>' + data[i] + '</span></li>';
            }
            $('#opponentContent').html(opponent_str);
        }

        function touch() {
            var event = event || window.event;

            var target = document.getElementById("visitstepNav");

            switch (event.type) {
                case "touchstart":
                    //target.style.left = event.touches[0].clientX + "px";
                    break;
                case "touchend":
                    beforeClient = null;
                    break;
                case "touchmove":
                    event.preventDefault();
                    var curleft = Number(target.style.left.slice(0, -2)) + Number(event.touches[0].clientX - beforeClient);
                    beforeClient && (curleft < 0) && (curleft > 0 - $('#visitstepNav')[0].clientWidth) && (target.style.left = curleft + "px");
                    beforeClient = event.touches[0].clientX;
                    break;
            }
        }


    };

    window.pagetitle = {
        about: "关于玄讯",
        industry: "选择行业",
        role: "选择角色",
        check: "考勤",
        featurelist: "功能列表",
        terminal: "附近终端",
        addterminal: "增加终端",
        myterminal: "我的终端",
        editterminal: "修改终端",
        visit: "今日拜访",
        mypromotion: "我的促销",
        terminalactivity: "终端活跃度",
        activedetail: "终端活跃度明细",
        relateterminal: "关联终端",
        performlist: "业务员-业绩",
        rank: "达人榜",
        salesvolumn: "订单查询",
        visitstep: "店面工作",
        visitreview: "拜访回顾"
    }

    return {
        about: about,
        industry: industry,
        role: role,
        check: check,
        featurelist: featurelist,
        terminal: terminal,
        addterminal: addterminal,
        myterminal: myterminal,
        editterminal: editterminal,
        visitstep: visitstep,
        pagetitle: pagetitle,
        activedetail: activedetail
    }
})
